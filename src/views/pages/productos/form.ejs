<h1><%= producto ? 'Editar' : 'Nuevo' %> producto</h1>
<form action="<%= producto ? '/productos/' + producto.id + '/editar' : '/productos/nuevo' %>" method="POST">
  <div class="mb-3">
    <label class="form-label">Nombre</label>
    <input type="text" name="nombre" class="form-control" value="<%= (producto && producto.nombre) || (old && old.nombre) || '' %>">
  </div>
  <div class="mb-3">
    <label class="form-label">Descripción</label>
    <textarea name="descripcion" class="form-control"><%= (producto && producto.descripcion) || (old && old.descripcion) || '' %></textarea>
  </div>
  <div class="row">
    <div class="col-md-4 mb-3">
      <label class="form-label">Precio</label>
      <input type="number" step="0.01" name="precio" class="form-control" value="<%= (producto && producto.precio) || (old && old.precio) || '' %>">
    </div>
    <div class="col-md-4 mb-3">
      <label class="form-label">Stock</label>
      <input type="number" name="stock" class="form-control" value="<%= (producto && producto.stock) || (old && old.stock) || '' %>">
      <div class="form-text">Cantidad actual disponible</div>
    </div>
    <div class="col-md-4 mb-3">
      <label class="form-label">Stock mínimo</label>
      <input type="number" name="stock_minimo" class="form-control" value="<%= (producto && producto.stock_minimo) || (old && old.stock_minimo) || '' %>">
      <div class="form-text">Umbral mínimo antes de reponer</div>
    </div>
  </div>
  <div class="mb-3">
    <label class="form-label">Localización</label>
    <select name="localizacion_id" class="form-select">
      <option value="">Seleccione...</option>
      <% localizaciones.forEach(l => { %>
        <option value="<%= l.id %>" <%= ((producto && producto.localizacion_id==l.id) || (old && old.localizacion_id==l.id)) ? 'selected' : '' %>><%= l.nombre %></option>
      <% }) %>
    </select>
  </div>
  <div class="mb-3">
    <label class="form-label">Categorías</label>
    <% categorias.forEach(c => { %>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="categorias[]" value="<%= c.id %>" id="cat_<%= c.id %>"
          <%= (producto && producto.categorias && producto.categorias.includes(c.id)) || (old && old.categorias && old.categorias.includes(String(c.id))) ? 'checked' : '' %>>
        <label class="form-check-label" for="cat_<%= c.id %>"><%= c.nombre %></label>
      </div>
    <% }) %>
  </div>
  <div class="mb-3">
    <label class="form-label">Proveedores</label>
    <% proveedores.forEach(p => { %>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="proveedores[]" value="<%= p.id %>" id="prov_<%= p.id %>"
          <%= (producto && producto.proveedores && producto.proveedores.includes(p.id)) || (old && old.proveedores && old.proveedores.includes(String(p.id))) ? 'checked' : '' %>>
        <label class="form-check-label" for="prov_<%= p.id %>"><%= p.nombre %></label>
      </div>
    <% }) %>
  </div>
  <% if (errors.length) { %>
    <div class="alert alert-danger">
      <ul class="mb-0">
        <% errors.forEach(e => { %><li><%= e.msg %></li><% }) %>
      </ul>
    </div>
  <% } %>
  <button class="btn btn-primary">Guardar</button>
</form>
