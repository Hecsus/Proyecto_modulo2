<h1><%= usuario ? 'Editar' : 'Nuevo' %> usuario</h1>
<form action="<%= usuario ? '/usuarios/' + usuario.id + '/editar' : '/usuarios/nuevo' %>" method="POST">
  <div class="row">
    <div class="col-md-6 mb-3">
      <label class="form-label">Nombre</label>
      <input type="text" name="nombre" class="form-control" value="<%= oldInput?.nombre || usuario?.nombre || '' %>">
    </div>
    <div class="col-md-6 mb-3">
      <label class="form-label">Apellidos</label>
      <input type="text" name="apellidos" class="form-control" value="<%= oldInput?.apellidos || usuario?.apellidos || '' %>">
    </div>
  </div>
  <div class="row">
    <div class="col-md-6 mb-3">
      <label class="form-label">Email</label>
      <input type="email" id="email" name="email" class="form-control" value="<%= oldInput?.email || usuario?.email || '' %>" required>
      <input type="email" id="emailConfirm" name="emailConfirm" class="form-control mt-1" value="<%= oldInput?.emailConfirm || '' %>" required placeholder="Confirmar email">
    </div>
    <div class="col-md-6 mb-3">
      <label class="form-label">Teléfono</label>
      <input type="text" name="telefono" class="form-control" value="<%= oldInput?.telefono || usuario?.telefono || '' %>">
    </div>
  </div>
  <div class="row">
    <div class="col-md-4 mb-3">
      <label class="form-label">Rol</label>
      <select name="rol" class="form-select">
        <% roles.forEach(r => { %>
          <option value="<%= r.id %>" <%= (oldInput?.rol || usuario?.rol_id) == r.id ? 'selected' : '' %>><%= r.nombre %></option>
        <% }) %>
      </select>
    </div>
    <% if (!usuario) { %>
    <div class="col-md-4 mb-3">
      <label class="form-label">Contraseña</label>
      <div class="input-group">
        <input type="password" id="password" name="password" class="form-control" required minlength="8">
        <button type="button" data-toggle="password" data-target="#password" class="btn btn-outline-secondary" aria-pressed="false" aria-label="Mostrar contraseña"><i class="bx bx-show"></i></button>
      </div>
      <div class="input-group mt-1">
        <input type="password" id="passwordConfirm" name="passwordConfirm" class="form-control" required minlength="8" placeholder="Confirmar contraseña">
        <button type="button" data-toggle="password" data-target="#passwordConfirm" class="btn btn-outline-secondary" aria-pressed="false" aria-label="Mostrar contraseña"><i class="bx bx-show"></i></button>
      </div>
    </div>
    <% } %>
  </div>
  <% if (errors.length) { %>
    <div class="alert alert-danger">
      <ul class="mb-0">
        <% errors.forEach(e => { %><li><%= e.msg %></li><% }) %>
      </ul>
    </div>
  <% } %>
  <button class="btn btn-primary">Guardar</button>
</form>
<!-- [checklist] Requisito implementado | Validación aplicada | SQL parametrizado (si aplica) | Comentarios modo curso | Sin código muerto -->
