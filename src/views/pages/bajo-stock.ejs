<h1>Bajo stock</h1>
<form method="get" class="row g-2 mb-3">
  <div class="col-md-3">
    <input type="text" name="qName" class="form-control" placeholder="Nombre" value="<%= filters.qName || '' %>">
  </div>
  <div class="col-md-3">
    <div class="input-group">
      <select name="priceOp" class="form-select">
        <option value="">Precio</option>
        <option value="eq" <%= filters.priceOp==='eq'?'selected':'' %>>=</option>
        <option value="lte" <%= filters.priceOp==='lte'?'selected':'' %>><=</option>
        <option value="gte" <%= filters.priceOp==='gte'?'selected':'' %>>>=</option>
      </select>
      <input type="number" step="0.01" name="price" class="form-control" value="<%= filters.price || '' %>">
    </div>
  </div>
  <div class="col-md-3">
    <div class="input-group">
      <select name="stockOp" class="form-select">
        <option value="">Stock</option>
        <option value="eq" <%= filters.stockOp==='eq'?'selected':'' %>>=</option>
        <option value="lte" <%= filters.stockOp==='lte'?'selected':'' %>><=</option>
        <option value="gte" <%= filters.stockOp==='gte'?'selected':'' %>>>=</option>
      </select>
      <input type="number" name="stock" class="form-control" value="<%= filters.stock || '' %>">
    </div>
  </div>
  <div class="col-md-3">
    <div class="input-group">
      <select name="minOp" class="form-select">
        <option value="">Stock mín</option>
        <option value="eq" <%= filters.minOp==='eq'?'selected':'' %>>=</option>
        <option value="lte" <%= filters.minOp==='lte'?'selected':'' %>><=</option>
        <option value="gte" <%= filters.minOp==='gte'?'selected':'' %>>>=</option>
      </select>
      <input type="number" name="min" class="form-control" value="<%= filters.min || '' %>">
    </div>
  </div>
  <div class="col-md-3">
    <select name="localizacionId" class="form-select">
      <option value="">Localización</option>
      <% localizaciones.forEach(l => { %>
        <option value="<%= l.id %>" <%= Number(filters.localizacionId) === l.id ? 'selected' : '' %>><%= l.nombre %></option>
      <% }) %>
    </select>
  </div>
  <div class="col-md-3">
    <select name="categoriaId" class="form-select">
      <option value="">Categoría</option>
      <% categorias.forEach(c => { %>
        <option value="<%= c.id %>" <%= Number(filters.categoriaId) === c.id ? 'selected' : '' %>><%= c.nombre %></option>
      <% }) %>
    </select>
  </div>
  <div class="col-md-3">
    <select name="proveedorId" class="form-select">
      <option value="">Proveedor</option>
      <% proveedores.forEach(p => { %>
        <option value="<%= p.id %>" <%= Number(filters.proveedorId) === p.id ? 'selected' : '' %>><%= p.nombre %></option>
      <% }) %>
    </select>
  </div>
  <div class="col-md-3">
    <select name="sortBy" class="form-select">
      <option value="id" <%= (filters.sortBy || 'id')==='id' ? 'selected' : '' %>>Ordenar por ID</option>
      <option value="nombre" <%= filters.sortBy==='nombre'?'selected':'' %>>Nombre</option>
      <option value="precio" <%= filters.sortBy==='precio'?'selected':'' %>>Precio</option>
      <option value="stock" <%= filters.sortBy==='stock'?'selected':'' %>>Stock</option>
      <option value="stock_minimo" <%= filters.sortBy==='stock_minimo'?'selected':'' %>>Stock mínimo</option>
    </select>
  </div>
  <div class="col-md-3">
    <select name="sortDir" class="form-select">
      <option value="asc" <%= (filters.sortDir || 'asc')==='asc' ? 'selected' : '' %>>Asc</option>
      <option value="desc" <%= (filters.sortDir || 'asc')==='desc' ? 'selected' : '' %>>Desc</option>
    </select>
  </div>
  <div class="col-md-3">
    <button type="submit" class="btn btn-primary w-100">Aplicar</button>
  </div>
</form>
<table class="table table-striped">
  <thead>
    <tr>
      <th>ID</th>
      <th>Nombre</th>
      <th>Precio</th>
      <th>Stock</th>
      <th>Stock mínimo</th>
      <th>Localización</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <% productos.forEach(p => { %>
      <tr class="table-warning">
        <td><%= p.id %></td>
        <td><%= p.nombre %></td>
        <td><%= p.precio %></td>
        <td><%= p.stock %></td>
        <td><%= p.stock_minimo %></td>
        <td><%= p.localizacion %></td>
        <td>
          <a href="/productos/<%= p.id %>?returnTo=<%= encodeURIComponent(request.originalUrl) %>" class="btn btn-sm btn-primary"><i class='bx bx-show'></i></a>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>
<%
  const params = new URLSearchParams(filters);
%>
<nav>
  <ul class="pagination">
    <% for(let i=1;i<=totalPages;i++){ params.set('page', i); %>
      <li class="page-item <%= i===page ? 'active' : '' %>"><a class="page-link" href="?<%= params.toString() %>"><%= i %></a></li>
    <% } %>
  </ul>
</nav>
